<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drawware IDE</title>
</head>
<body>
    <h1>Drawware IDE</h1>
    
    <!-- Editable textarea -->
    <textarea id="filename" rows="1" cols="80" placeholder="Type .drawio filename here..."></textarea>
    
    <h3>Input:</h3>
    <textarea id="input" rows="3" cols="80" placeholder="Type input text here..."></textarea>
    
    <!-- Readonly textarea to display server responses -->
    <h3>Output:</h3>
    <textarea id="output" rows="10" cols="80" readonly></textarea>

    <h3>Errors:</h3>
    <textarea id="output" rows="1" cols="30" readonly></textarea>

    <h3>Probes (A,B,C):</h3>
    <textarea id="A" rows="3" cols="30" readonly></textarea>

    <textarea id="B" rows="3" cols="30" readonly></textarea>

    <textarea id="C" rows="3" cols="30" readonly></textarea>

    <script>
        // Open a WebSocket connection to the server
        const socket1 = new WebSocket('ws://localhost:8765');
        const socket2 = new WebSocket('ws://localhost:8766');

        // Get the textarea, button, and readonly textarea elements
        const inputarea = document.getElementById('input');
        const filenamearea = document.getElementById('filename');
        const output = document.getElementById('output');

      // Send the content of the 'input' textarea on input change
      inputarea.addEventListener('input', () => {
          if (socket2.readyState === WebSocket.OPEN) {
              const message = JSON.stringify({
                  name: inputarea.id,
                  content: inputarea.value
              });
              socket2.send(message);
          }
      });

      // Send the content of the 'filename' textarea on input change
      filenamearea.addEventListener('input', () => {
          if (socket2.readyState === WebSocket.OPEN) {
              const message = JSON.stringify({
                  name: filenamearea.id,
                  content: filenamearea.value
              });
              socket2.send(message);
          }
      });

        // Handle incoming messages from the server 1
        socket1.addEventListener('message', (event) => {
            const data = JSON.parse(event.data);
	    console.log (event.data);
	    console.log (data);

            output.value = data.output;
	    A.value = data.A;
	    B.value = data.B;
	    C.value = data.C;
        });

      // Handle connection open
      socket1.onopen = () => {
          console.log("Connected to WebSocket 1 server.");
      };
      // Handle connection closure
      socket1.onclose = () => {
          console.log("Disconnected from WebSocket 1 server.");
      };
      
        // Handle connection errors
        socket1.addEventListener('error', (error) => {
            console.error('WebSocket 1 error:', error);
        });


        // Handle incoming messages from the server 2
        socket2.addEventListener('message', (event) => {
            const data = JSON.parse(event.data);
	    console.log (event.data);
	    console.log (data);

            output.value = data.output;
	    A.value = data.A;
	    B.value = data.B;
	    C.value = data.C;
        });

      // Handle connection open
      socket2.onopen = () => {
          console.log("Connected to WebSocket 2 server.");
      };
      // Handle connection closure
      socket2.onclose = () => {
          console.log("Disconnected from WebSocket 2 server.");
      };
      
        // Handle connection errors
        socket2.addEventListener('error', (error) => {
            console.error('WebSocket 2 error:', error);
        });
    </script>
</body>
</html>
